jQuery(document).ready(function(){if(typeof(_SFAddressSettings)!="undefined"){jQuery(document).amaAddressControl(_SFAddressSettings)}});(function(f){var e={};var l={key:"",apiUrl:"https://rapidmatch.datasan.com.au/v1/",themeUrl:"https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.21/themes/",theme:"start",datasanCSS:"https://d1c24wnrse4bd3.cloudfront.net/api/sf/1.7/datasan-sf.css",showCopyAddress:true,dataType:"json",addressCapitalize:"false",defaultCountry:"Australia"};f.fn.amaAddressControl=function(w){e=f.extend({},l,w);j(e.theme);j(e.datasanCSS);if(f.trim(e.key)==""){c("DataSan key does not exist, please contact your administrator.");return this}f(e.accounts).each(function(){if(f.trim(this.abn)==""){this.abn=this.account+"_abn"}h(this)});f(e.addresses).each(function(y,x){if(f.trim(x.country)==""||f.trim(x.state)==""||f.trim(x.city)==""||f.trim(x.postalcode)==""||f.trim(x.street)==""){return}var z=x.country;if(x.country.search(/^(con19country|con18country|acc17country|acc18country|lea16country)$/i)==0){z=x.country.substring(0,5);x.ilecell=z+"_ilecell";x.dpidilecell=x.dpid+"_ilecell"}if(f.trim(x.locality)==""){x.locality=z+"locality"}if(f.trim(x.dpid)==""){x.dpid=z+"dpid"}if(f.trim(x.localityLabel)==""){x.localityLabel="Suburb or Postcode"}if(f.trim(x.dpidLabel)==""){x.dpidLabel="DPID"}if(f.trim(x.ilecell)!=""){f.fn.amaAddressControl.inlineAddressControl(x)}if(f("#"+s(x.country)).size()==0||m.get(x.country)!=null){return}m.add(new i(x));if(e.showCopyAddress&&m.data.length==2){f(".pbSubExtra a:contains('Copy')").hide();m.data[0].setCopyAddress(1,0);m.data[1].setCopyAddress(0,1)}});return this};f.fn.amaAddressControl.inlineAddressControl=function(w){w.ilecell=s(w.ilecell);w.dpidilecell=s(w.dpidilecell);w.dpid=s(w.dpid);function x(z,y){if(f("#"+z).size()>0&&f("#"+y).size()>0&&/AUSTRALIA$/.test(f.trim(f("#"+z).text()).toUpperCase())){if(/\d/.test(f.trim(f("#"+y).text()))){f("#"+z).removeClass("tooltipError").addClass("tooltipOk")}else{f("#"+z).removeClass("tooltipOk").addClass("tooltipError")}}else{f("#"+z).removeClass("tooltipOk").removeClass("tooltipError")}}x(w.ilecell,w.dpidilecell);f("#"+w.ilecell).removeAttr("ondblclick").dblclick(function(y){if(window.sfdcPage&&window.sfdcPage.hasRun){if(f("#"+w.dpidilecell).size()>0){sfdcPage.inlineEditData.openField(sfdcPage.getFieldById(w.dpid))}sfdcPage.dblClickField(y,this)}if(m.get(w.country)==null){m.add(new i(f.extend({},w,{dpid:w.dpid+"_"})))}else{m.get(w.country).setValues()}f("#InlineEditDialog :button[value='OK']").unbind("click");f("#InlineEditDialog :button[value='OK']").removeAttr("onclick").click(function(z){if(sfdcPage.inlineEditData.closeCurrentField()){sfdcPage.getDialogById("InlineEditDialog").hide()}if(f("#"+w.dpidilecell).size()>0){sfdcPage.inlineEditData.openField(sfdcPage.getFieldById(w.dpid))}f("#"+w.dpid).val(f("#"+w.dpid+"_").val());sfdcPage.inlineEditData.closeCurrentField();f("#"+w.dpidilecell+" .inlineEditUndoLink").hide();x(w.ilecell,w.dpidilecell);f("#"+w.ilecell+" .inlineEditUndoLink").unbind("click");f("#"+w.ilecell+" .inlineEditUndoLink").click(function(){sfdcPage.inlineEditData.resetFieldById(w.country.substring(0,5));sfdcPage.inlineEditData.resetFieldById(w.dpid);x(w.ilecell,w.dpidilecell)})});f("#InlineEditDialog :button[value='Cancel']").click(function(z){sfdcPage.inlineEditData.resetFieldById(w.dpid)})});f("#"+w.dpidilecell).removeAttr("ondblclick")};var h=function(w){if(f("#"+s(w.abn)).size()==0){f("#"+s(w.account)).after('<input id="'+w.abn+'" name="'+w.abn+'" type="hidden">')}if(f("#"+s(w.account)+"_lookup").size()==0){var x=f("<a id='"+w.account+"_lookup' href='javascript:void(0)' title='Lookup businesses when they registered for an Australian Business Number (ABN)'>ABN Lookup</a>");x.click(function(){o(w)});f("#"+s(w.account)).parent().append("&nbsp;").append(x)}};var m=new function(){this.data=[];this.add=function(w){if(this.get(w.id)==null){this.data.push(w)}};this.get=function(x){for(var w=0;w<this.data.length;w++){if(this.data[w].id==x){return this.data[w]}}return null}};var i=function(F){this.$table=f("#"+s(F.country)).parents("table").first();this.$country=f("#"+s(F.country));this.$state=f("#"+s(F.state));this.$city=f("#"+s(F.city));this.$zip=f("#"+s(F.postalcode));this.$street=f("#"+s(F.street));this.$locality=f("#"+s(F.locality));this.$dpid=f("#"+s(F.dpid));this.fields1=[this.$street,this.$city,this.$state,this.$zip,this.$country];this.fields2=[this.$country,this.$city,this.$street,this.$state,this.$zip];this.id=F.country;var H=this;var D=[];var z=[];f.each(H.fields1,function(I,J){D.push(J.parent());z.push(J.attr("tabindex"))});this.init=function(){G();x();H.setValues();A()};this.setCopyAddress=function(K,J){var I=f("<a href='javascript:void(0);'>Copy address from the other</a><br/>").click(function(){b(K,J);C()});D[0].prepend(I).prev().prepend("<br/>")};this.setValues=function(){if(H.$country.val()==""){H.$country.val(e.defaultCountry)}H.$locality.trigger("setvalue");if(/\d/.test(f.trim(f("#"+s(F.dpidilecell)).text()))){H.$dpid.val(f.trim(f("#"+s(F.dpidilecell)).text()))}};function G(){if(H.$locality.size()==0){H.$city.parent().prev().prepend('<label for="'+F.locality+'">'+F.localityLabel+"</label>");H.$city.parent().prepend('<input id="'+F.locality+'" name="'+F.locality+'" size="'+30+'" maxlength="'+80+'" tabindex="'+H.$country.attr("tabindex")+'" type="text">');H.$locality=f("#"+s(F.locality))}if(H.$dpid.size()==0){if(f("label:contains('"+F.dpidLabel+"')",H.$country.parents("tr").first().next()).size()==0){H.$country.parents("tr").first().after("<tr></tr>")}H.$country.parents("tr").first().next().append('<td class="labelCol"><label for="'+F.dpid+'">'+F.dpidLabel+'</label></td><td><input id="'+F.dpid+'" name="'+F.dpid+'" size="'+10+'" maxlength="'+10+'" tabindex="'+H.$country.attr("tabindex")+'" type="text"></td>');H.$dpid=f("#"+s(F.dpid))}H.fields=[H.$country,H.$city,H.$zip,H.$state,H.$street,H.$locality,H.$dpid]}function x(){H.$country.on("autocompletechange",function(){C()});H.$locality.on("autocompletechange",function(){H.$street.trigger("clear")}).on("keyup",function(){if(f.trim(H.$locality.val())==""){H.$locality.trigger("clear")}H.$locality.trigger("split")}).on("split",function(){var I=t(H.$locality.val());H.$city.val(I.city);H.$state.val(I.state);H.$zip.val(I.zip)}).on("setvalue",function(){H.$locality.val(d(H.$city.val(),H.$state.val(),H.$zip.val()))}).on("clear",function(){H.$locality.val("");H.$street.trigger("clear")});H.$city.on("autocompletechange",function(){H.$street.trigger("clear")});H.$zip.on("autocompletechange",function(){H.$street.trigger("clear")});H.$street.on("keyup",function(){if(f.trim(H.$street.val())==""){H.$street.trigger("clear")}}).on("clear",function(){H.$street.val("");H.$dpid.trigger("clear")});H.$dpid.on("clear",function(){H.$dpid.val("")})}function C(){if(H.$country.val().toUpperCase()=="AUSTRALIA"||H.$country.val().toUpperCase()=="AU"){A()}else{y()}}function A(){f.each(H.fields2,function(I,J){D[I].append(J);D[I].prev().append(w(J))});E(H.$country);E(H.$locality);E(H.$street);B(H.$city);B(H.$state);B(H.$zip);H.$street.attr("tabindex",H.$country.attr("tabindex"));n(H);a(H);q(H);u(H);p(H)}function y(){f.each(H.fields1,function(I,J){D[I].append(J);D[I].prev().append(w(J))});E(H.$country);B(H.$locality);E(H.$street);E(H.$city);E(H.$state);E(H.$zip);H.$street.attr("tabindex",z[0]);H.$locality.autocomplete("destroy");H.$city.autocomplete("destroy");H.$zip.autocomplete("destroy");H.$street.autocomplete("destroy")}function E(I){I.show();w(I).show();I.parents("tr").first().show()}function B(I){I.hide();w(I).hide();if(f("input:visible",I.parents("tr").first()).size()==0){I.parents("tr").first().hide()}}function w(I){return f("label[for='"+I.attr("id")+"']")}this.init()};function j(w){var x=document.createElement("link");x.rel="stylesheet";x.type="text/css";x.href=w;if(w.indexOf("/")==-1){x.href=e.themeUrl+w+"/jquery-ui.css"}document.getElementsByTagName("head")[0].appendChild(x)}function p(w){var y=function(z){if(z.label.toUpperCase().indexOf(w.$country.val().toUpperCase())==0){return{label:f.trim(z.label).toUpperCase()}}};var x=function(z,A){w.$country.val(A.item.label);z.stopPropagation();return false};f(w.$country).autocomplete({source:function(A,z){A.term="country";var B=e.apiUrl+"countries?auth_token="+g(e.key);r(A,z,B,y)},focus:function(z,A){return false},select:x})}function n(w){v(w,w.$city)}function a(w){v(w,w.$zip)}function q(w){v(w,w.$locality)}function v(w,z){var y=function(B){var A=d(k(f.trim(B.locality_name)),f.trim(B.state),f.trim(B.postcode));return{label:A,city:k(f.trim(B.locality_name)),zip:f.trim(B.postcode),state:f.trim(B.state),id:f.trim(B.locality_id)}};var x=function(A,B){w.$city.val(B.item.city);w.$zip.val(B.item.zip);w.$state.val(B.item.state);w.$locality.val(B.item.label);w.$locality.trigger("change");A.stopPropagation();return false};f(z).autocomplete({source:function(C,A){var B=e.apiUrl+"address_line_2?auth_token="+g(e.key)+"&locality_or_postcode="+g(z.val());r(C,A,B,y)},focus:function(A,B){return false},select:x})}function u(w){var y=function(z){return{label:k(z.address_line_1),dpid:z.delivery_point_id,city:k(z.locality_name),zip:z.postcode,state:z.state}};var x=function(z,A){w.$city.val(A.item.city);w.$zip.val(A.item.zip);w.$state.val(A.item.state);w.$locality.trigger("setvalue");w.$street.val(A.item.label);w.$dpid.val(A.item.dpid);z.stopPropagation();return false};f(w.$street).autocomplete({search:function(z,A){if(f.trim(w.$city.val())==""&&f.trim(w.$zip.val())==""){return false}return true},source:function(B,z){var A=e.apiUrl+"address_line_1?auth_token="+g(e.key)+"&locality_and_postcode="+g(w.$city.val()+" "+w.$zip.val())+"&address_line_1="+g(w.$street.val());r(B,z,A,y)},focus:function(z,A){return false},select:x})}function o(z){var y=f.trim(f("#"+s(z.account)).val());if(y==""){return}var x=f("<div id='dialog-confirm' title='ABN Lookup services'></div>").append("<table style='border-collapse:collapse;padding:4px;width:100%;' class='lktable ui-widget ui-widget-content'><tr><td width='20%'><label for='lkname'><b>Company Name</b></label></td><td><input id='lkname' maxlength='80' name='lkname' size='50' type='text' value='"+y+"'></td><td><input value=' Search ' class='btn' id='lksearch' type='button'></td></tr></table>").append("<div id='dialog-content' style='margin-top:1em;'></div>");f(x).dialog({width:600,height:400,modal:true,draggable:true,resizable:false,close:function(A,B){f(x).dialog("destroy");f(x).remove()}});f("#lksearch").click(function(){w(f("#lkname").val())});f("#lkname").keypress(function(A){if(A.keyCode==13){w(f("#lkname").val())}});w(y);function w(A){f("#dialog-content").html("<p style='color:#ff0000;'>Loading...</p>");f("#lkname").addClass("ui-autocomplete-loading");jQuery.ajax({url:e.apiUrl+"company_lookup?auth_token="+g(e.key)+"&name="+g(A),dataType:e.dataType,type:"get",error:function(B){f(".ui-autocomplete-loading").removeClass("ui-autocomplete-loading");f("#dialog-content").html("<p><span class='ui-icon ui-icon-alert' style='float:left; margin-right: .3em;'></span>Unexpected loading error</p>")},success:function(D){f("#lkname").removeClass("ui-autocomplete-loading");var C="";var B=D.ABRPayloadSearchResults.response.exception;if(typeof(B)!="undefined"){C="<h2>"+B.exceptionDescription+"</h2>"}else{C="<table style='border-collapse:collapse;padding:4px;' class='lktable ui-widget ui-widget-content'>";C+="<tr class='ui-widget-header'><th>Name</th><th>ABN</th><th>State</th><th>Postcode</th><th>Status</th></tr>";f.each(f(D.ABRPayloadSearchResults.response.searchResultsList.searchResultsRecord),function(K,M){var E="";var J=M.mainName||M.mainTradingName||M.otherTradingName;if(J!=null){E=J.organisationName}if(E==""&&M.legalName!=null){E=M.legalName.fullName}var G=M.ABN.identifierValue;var H=M.ABN.identifierStatus;var L=M.mainBusinessPhysicalAddress.stateCode;var I=M.mainBusinessPhysicalAddress.postcode;var F="background:#fff;";if(K%2==0){F="background:#f2f2f2;"}C+="<tr style='"+F+"'><td width='50%'><b><a href='javascript:void(0)'>"+E+"</a></b></td><td>"+G+"</td><td>"+L+"</td><td>"+I+"</td><td>"+H+"</td></tr>"});C+="</table>";C+="<p><span class='ui-icon ui-icon-info' style='float:left; margin-right: .3em;'></span>"+D.ABRPayloadSearchResults.response.usageStatement+"</p>"}f("#dialog-content").html(C);f(".lktable").css("width",f("#dialog-content").innerWidth()+"px");f("a",f("#dialog-content")).click(function(){f("#"+s(z.account)).val(f(this).parent().text());f("#"+s(z.abn)).val(f(this).parents("td").first().next().text());f(x).dialog("destroy");f(x).remove()})}})}}function t(x){var y=x.match(/\d{4}/)?x.match(/\d{4}/)[0]:"";var w=x.match(/\bNSW\b|\bACT\b|\bVIC\b|\bQLD\b|\bSA\b|\bWA\b|\bTAS\b|\bNT\b/i);var z=w?w[0]:"";var A=f.trim(x.replace(y,"").replace(/\bNSW\b|\bACT\b|\bVIC\b|\bQLD\b|\bSA\b|\bWA\b|\bTAS\b|\bNT\b/i,"").replace(/,/g,""));return{city:A,state:z,zip:y}}function d(z,y,x){var w=z;if(w!=""){w+=", "+y}if(w!=", "){w+=" "+x}return f.trim(w)}function r(z,w,x,y){jQuery.ajax({url:x,dataType:e.dataType,type:"get",success:function(B){var A=jQuery(B.response.docs).map(function(C){return y(this)});w(A);f(".ui-autocomplete-loading").removeClass("ui-autocomplete-loading")},error:function(A){f(".ui-autocomplete-loading").removeClass("ui-autocomplete-loading")}})}function g(w){return encodeURIComponent(f.trim(w))}function k(w){if(e.addressCapitalize=="true"){return w.toLowerCase().replace(/(^|\s|[0-9]|-|\')([a-z])/g,function(x,z,y){return z+y.toUpperCase()})}else{return w}}function s(w){if(w==null||w=="undefined"){return null}return w.replace(/(:|\.)/g,"\\$1")}function b(x,w){if(m.data.length>1){f.each(m.data[w].fields,function(y,z){z.val(m.data[x].fields[y].val());if(m.data[x].fields[y].attr("readonly")){z.attr("readonly","readonly")}else{z.removeAttr("readonly")}})}}function c(w){if(typeof(w)=="undefined"){return}f("#ama_message").html('<div class="ui-state-error ui-corner-all" style="padding: 0 .7em;"><p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span><span>'+w+"<span></p></div>")}f.extend(f.ui.autocomplete.prototype,{_renderItem:function(w,x){return f("<li></li>").data("item.autocomplete",x).append(f("<a></a>").html(x.label)).appendTo(w)},_renderMenu:function(y,x){var w=this;f.each(x,function(z,A){w._renderItem(y,A)});w.menu.element.appendTo(w.element.parent())}});if(window.XDomainRequest&&!f.support.cors){f.ajaxTransport(function(x){var w;return{send:function(z,y){w=new XDomainRequest();w.open(x.type,x.url);w.onload=function(){y(200,"OK",{text:w.responseText},"Content-Type: "+w.contentType)};if(x.xhrFields){w.onerror=x.xhrFields.error;w.ontimeout=x.xhrFields.timeout}w.send((x.hasContent&&x.data)||null)},abort:function(){if(w){w.abort()}}}})}})(jQuery);